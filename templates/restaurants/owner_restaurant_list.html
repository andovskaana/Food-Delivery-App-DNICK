{% extends 'base.html' %}

{% block title %}My Restaurants{% endblock %}

{% block content %}
<div class="container my-4">

  <h1 class="mb-3">My Restaurants</h1>
  <p class="text-muted">
    Here you can manage the menu items (products) for each of your restaurants.
  </p>

  {% if messages %}
    <div class="mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if restaurants %}
    {% for restaurant in restaurants %}
      <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-0">{{ restaurant.name }}</h5>
            {% if restaurant.address %}
              <small class="text-muted d-block">
                {{ restaurant.address }}
              </small>
            {% endif %}
          </div>

          <div>
            <a href="{% url 'restaurants:edit' restaurant.pk %}"
               class="btn btn-sm btn-outline-secondary">
              Edit restaurant
            </a>
          </div>
        </div>

        <div class="card-body p-0">

          {% if restaurant.products.all %}
            <div class="table-responsive">
              <table class="table mb-0 align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Category</th>
                    <th scope="col" class="text-end">Price</th>
                    <th scope="col" class="text-center">Quantity</th>
                    <th scope="col" class="text-center">Available</th>
                    <th scope="col" class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for product in restaurant.products.all %}
                    <tr>
                      <td>
                        <strong>{{ product.name }}</strong><br>
                        {% if product.description %}
                          <small class="text-muted">
                            {{ product.description|truncatechars:60 }}
                          </small>
                        {% endif %}
                      </td>
                      <td>{{ product.category|default:"—" }}</td>
                      <td class="text-end">${{ product.price }}</td>
                      <td class="text-center">{{ product.quantity }}</td>
                      <td class="text-center">
                        {% if product.is_available %}
                          <span class="badge bg-success">Yes</span>
                        {% else %}
                          <span class="badge bg-secondary">No</span>
                        {% endif %}
                      </td>
                      <td class="text-end">
                        <a href="{% url 'restaurants:product_edit' product.pk %}"
                           class="btn btn-sm btn-outline-primary me-1">
                          Edit
                        </a>
                        <form method="post"
                              action="{% url 'restaurants:product_delete' product.pk %}"
                              class="d-inline"
                              onsubmit="return confirm('Delete this menu item?');">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-sm btn-outline-danger">
                            Delete
                          </button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="p-3 mb-0 text-muted">
              This restaurant has no menu items yet.
            </p>
          {% endif %}
        </div>

        <div class="card-footer text-end">
          <a href="{% url 'restaurants:product_create' restaurant.pk %}"
             class="btn btn-sm btn-success">
            Add menu item
          </a>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info mt-4">
      You don’t have any restaurants yet.
      <a href="{% url 'restaurants:create' %}" class="alert-link">Create your first restaurant</a>.
    </div>
  {% endif %}
</div>
{% endblock %}