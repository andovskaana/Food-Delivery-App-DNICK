# Food Delivery Web Application (DNICK / ДИНЧК)

Овој проект претставува целосно функционална веб апликација за онлајн нарачување и достава на храна, развиена со **Django** како проект по предметот **Дизајн на интеракцијата човек-компјутер** (летен семестар, 2024/2025). Апликацијата е инспирирана од платформи како Korpa, Wolt и Glovo и е изработена како самостојно решение со фокус на: модуларна архитектура, поделба на одговорности, безбедност, одржливост и можност за проширување.

**GitHub:** https://github.com/andovskaana/Food-Delivery-App-DNICK

---

## Содржина
- [Клучни функционалности](#клучни-функционалности)
- [Технологии](#технологии)
- [Архитектура и модуларна поделба](#архитектура-и-модуларна-поделба)
- [Автентикација, авторизација и улоги (RBAC)](#автентикација-авторизација-и-улоги-rbac)
- [Кориснички текови (User flows)](#кориснички-текови-user-flows)
- [Тек на нарачка и статуси](#тек-на-нарачка-и-статуси)
- [Мапа и симулација на достава (Live tracking demo)](#мапа-и-симулација-на-достава-live-tracking-demo)
- [Плаќање: Stripe (test mode) и симулирано плаќање](#плаќање-stripe-test-mode-и-симулирано-плаќање)
- [Податоци: Scraping и Seed механизам](#податоци-scraping-и-seed-механизам)
- [Администрација и управување](#администрација-и-управување)
- [Локално стартување (Development)](#локално-стартување-development)
- [Тест корисници](#тест-корисници)
- [Автори](#автори)

---

## Клучни функционалности

- Модуларна архитектура (повеќе Django apps со јасна одговорност)
- RBAC (role-based access control) со улоги: `customer`, `owner`, `courier`, `admin`
- Customer функционалности: преглед на ресторани/мени, кошничка, checkout, плаќање, следење на нарачка
- Courier функционалности: листа на достапни нарачки, преземање (Accept), започнување достава (Start delivery), завршување (Mark delivered)
- Owner функционалности: управување со сопствени ресторани и нивното мени (CRUD)
- Payments модул: Stripe PaymentIntent (test mode) + симулирано плаќање (success/fail) преку посебни endpoint-и
- Track Order страница: Leaflet + OpenStreetMap + 30 секундна анимација (демо) и автоматско усогласување на статус во база

---

## Технологии

- Backend: **Django**
- Frontend: Django templates + JavaScript
- Payments: **Stripe** (test mode), Stripe Elements
- Maps/Tracking demo: **Leaflet**, **OpenStreetMap**
- Database: SQLite (dev) / според локална конфигурација

---

## Архитектура и модуларна поделба

Апликацијата е организирана модуларно преку повеќе Django apps:

- **core**  
  Глобални конфигурации, root рути, базни templates, static ресурси и механизам за иницијално полнење на база (seed).
- **accounts**  
  Регистрација, најава/одјава и custom User модел со дополнително поле `role`.
- **restaurants**  
  Домен на понуда: ресторани, менија/продукти, категории, работно време и достапност.
- **orders**  
  Трансакциски дел: кошничка, креирање нарачки, пресметка на вкупна цена, поврзување со корисник/ресторан и следење на статус.
- **payments**  
  Целосно изолиран модул за финансиска логика: Stripe интеграција и симулирано плаќање.

Овој пристап е стандард во професионален развој: ја подобрува организацијата на кодот, тестирањето и одржувањето, и овозможува полесно проширување.

---

## Автентикација, авторизација и улоги (RBAC)

Системот користи **role-based access control (RBAC)**. Во системот постојат четири улоги:

- **Customer** – краен корисник кој пребарува ресторани, прегледува менија, креира нарачки и врши плаќање
- **Owner** – сопственик кој управува со свои ресторани и менија
- **Courier** – доставувач кој има пристап до нарачки наменети за достава
- **Admin** – администратор со целосен пристап до системот

Правила:
- Секој новорегистриран корисник добива улога `customer`.
- Корисник **не може сам** да ја промени улогата.
- Промена на улога е дозволена исклучиво за администратор (преку админ слој).

---

## Кориснички текови (User flows)

### Customer
- Почетна страна (ListView) со server-side пребарување по име/опис
- Листа на ресторани со client-side пребарување (JavaScript)
- Страница на ресторан со мени; додавање во кошничка (се прикажуваат само достапни продукти)
- Checkout → плаќање → My Orders → Track Order

### Courier
- Courier Dashboard:
  - “Available Orders for Pickup” (Confirmed) → **Accept**
  - “My Active Deliveries” (Accepted/Picked_up) → **Start delivery** → **Mark delivered**
  - “My Delivered Orders” (Delivered) како историја

### Owner
- Управување со ресторани и менија (CRUD) во рамки на owner интерфејс (ограничено на сопствени ресурси)

### Admin
- Пристап до административни функционалности (custom административен слој + Django Admin Panel)
- Глобална контрола на корисници, улоги, ресторани, продукти, нарачки и плаќања

---

## Тек на нарачка и статуси

Секоја нарачка поминува низ јасно дефинирани состојби:

- **Placed** – нарачка креирана по checkout
- **Confirmed** – потврдена нарачка (успешно платена и/или прифатена за подготовка)
- **Accepted** – нарачката е преземена од courier (доделен курир)
- **Picked_up** – courier ја подигнал нарачката и е „на пат“
- **Delivered** – нарачката е доставена (финална состојба)
- **Canceled** – откажана (опционално)

Клучни правила за видливост:
- Courier ја гледа нарачката во dashboard дури по **Confirmed**.
- Мапата на Track Order не се прикажува во сите фази (види следната секција).

---

## Мапа и симулација на достава (Live tracking demo)

Track Order страницата вклучува демо симулација (не реален GPS tracking) со следна логика:

### Кога се прикажува мапата
- Ако нарачката **нема доделен courier** → не се прикажува мапа; се прикажува само прогрес/линија.
- Ако нарачката е **Accepted**, **Picked_up** или **Delivered** → се прикажува Leaflet мапа со:
  - точка за ресторан
  - точка за адреса на customer
  - позиција на courier (демо)

### Анимација (само за Picked_up)
- Анимација се вклучува **само** кога статусот е **Picked_up**.
- Се користи `requestAnimationFrame` за мазно движење.
- Траење: **30 секунди**, со easing (почеток и крај поспори, средина побрза).
- Позицијата на courier се пресметува со линеарна интерполација (lerp) помеѓу почетна и крајна координата.

### Автоматско означување Delivered
По истек на 30 секунди, front-end праќа AJAX POST кон:
- `/orders/track/<order_id>/mark-delivered/`

Endpoint-от серверски проверува:
- ако статусот е `picked_up` → го менува во `delivered` и враќа JSON одговор,
по што страницата се рефрешира за усогласен приказ.

### Ограничувања (важно)
Ова е демо симулација:
- не се користи реален GPS и live координати,
- геокодирањето е вештачко и служи визуелно да ги распореди точките,
- траењето е секогаш фиксни 30 секунди независно од растојание.

---

## Плаќање: Stripe (test mode) и симулирано плаќање

Платежниот процес е имплементиран како посебен и изолиран модул (**payments**) што е добра практика за безбедност и проширување.

- Секој обид за плаќање се евидентира преку модел `Payment` поврзан со нарачка (износ, валута, статус, PaymentIntent id).
- При checkout, системот креира/ажурира `Payment` и, ако Stripe е конфигуриран:
  - иницира Stripe **PaymentIntent** во **test mode**
  - го користи `client_secret` на frontend преку **Stripe Elements** (картичните податоци не поминуваат низ апликацијата)
- Ако Stripe не е достапен или за демонстрација:
  - постојат посебни endpoint-и за контролирано означување на плаќање како успешно/неуспешно

Stripe тест картички:
- https://docs.stripe.com/testing

---

## Податоци: Scraping и Seed механизам

Апликацијата не користи надворешно API за податоци. Наместо тоа:
- податоците за ресторани и менија се scrape-ани од Korpa,
- структурирани во Python,
- и внесени во база преку Django management command / seed механизам (`seed_data.py`).

Ова овозможува реалистична демо база, стабилно повторливо поставување и независност од надворешни сервиси.

---

## Администрација и управување

Административната функционалност е реализирана преку две целини:

1) **Custom Admin Dashboard** (апликациски админ слој)  
Достапен исклучиво за корисници со улога `admin`, со серверска проверка на улога (backend enforcement).

2) **Django Admin Panel**  
Достапен само за **superuser**. Овозможува целосен увид и контрола врз:
- корисници и улоги,
- ресторани и продукти,
- нарачки и статуси,
- плаќања и нивни состојби.

---
## Локално стартување (Development)

### Стартувај сервер
```bash
python manage.py runserver
```

### (Опционално) Креирај superuser за Django Admin
```bash
python manage.py createsuperuser
```

### (Опционално) Внеси иницијални податоци (seed)
> Доколку проектот има активиран seed механизам (на пр. `seed_data.py` или management command), изврши го според инструкциите во проектот.

---

## Тест корисници

| Role     | Username | Password |
|----------|----------|----------|
| Customer | customer | customer |
| Owner    | owner    | owner    |
| Courier  | courier  | courier  |
| Admin    | admin    | admin    |

---

## Автори

- Ана Андовска (221126)  
- Мила Јованоска (221034)

