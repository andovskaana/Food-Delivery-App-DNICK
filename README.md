# Food Delivery Web Application (DNICK / ДИНЧК)

Веб апликација за онлајн нарачување и достава на храна, развиена со **Django** како проект по предметот **Дизајн на интеракцијата човек-компјутер** (2024/2025). Решението симулира реален процес „крај-до-крај“: преглед на ресторани и менија, кошничка, checkout, плаќање, доделување courier и следење на нарачка.

**Highlights:** modular Django apps, **RBAC** (`customer`/`owner`/`courier`/`admin`), **Stripe (test mode)** + симулирано плаќање, и **Track Order** (Leaflet + 30s delivery demo).

**GitHub:** https://github.com/andovskaana/Food-Delivery-App-DNICK

---

## Содржина
- [Клучни функционалности](#клучни-функционалности)
- [Технологии](#технологии)
- [Архитектура и модуларна поделба](#архитектура-и-модуларна-поделба)
- [Автентикација, авторизација и улоги (RBAC)](#автентикација-авторизација-и-улоги-rbac)
- [Кориснички текови (User flows)](#кориснички-текови-user-flows)
- [Тек на нарачка и статуси](#тек-на-нарачка-и-статуси)
- [Мапа и симулација на достава (Live tracking demo)](#мапа-и-симулација-на-достава-live-tracking-demo)
- [Плаќање: Stripe (test mode) и симулирано плаќање](#плаќање-stripe-test-mode-и-симулирано-плаќање)
- [Податоци: Scraping и Seed механизам](#податоци-scraping-и-seed-механизам)
- [Администрација и управување](#администрација-и-управување)
- [Локално стартување (Development)](#локално-стартување-development)
- [Тест корисници](#тест-корисници)
- [Автори](#автори)

---

## Клучни функционалности

### Platform (Core)
- **Модуларна архитектура** со повеќе Django apps и јасна поделба на домени/одговорности.
- **Role-based access control (RBAC)** со улоги `customer`, `owner`, `courier`, `admin` (server-side авторизација).
- **Seed податоци** за реалистична демо содржина (ресторани/мени), без зависност од надворешни API.

### Customer Experience
- Преглед на ресторани и менија, пребарување и филтрирање.
- Кошничка и checkout со пресметка на вкупна цена.
- Плаќање (Stripe test mode или симулација), преглед на лични нарачки и **Track Order**.

### Courier Workflow
- Листа на достапни нарачки (`Confirmed`) и преземање (**Accept**).
- Активна достава (`Accepted` / `Picked_up`) со **Start delivery** и **Mark delivered**.
- Историја на доставени нарачки (`Delivered`).

### Owner Management
- Управување со **сопствени** ресторани и менија (CRUD), ограничено само на ресурси на сопственикот.

### Payments & Tracking (Demo)
- **Payments модул** со изолирана логика: Stripe PaymentIntent (test mode) + симулирано плаќање (success/fail).
- **Tracking demo**: Leaflet + OpenStreetMap, 30 секундна анимација (само за `Picked_up`) и автоматско усогласување на статус во база.

---

## Технологии

- **Backend:** Django  
- **Frontend:** Django templates + JavaScript  
- **Payments:** Stripe (test mode), Stripe Elements  
- **Maps / Tracking demo:** Leaflet, OpenStreetMap  
- **Database:** SQLite (development) / според локална конфигурација  

---

## Архитектура и модуларна поделба

Апликацијата е организирана преку повеќе Django apps, каде секој модул покрива јасен домен:

- **core** – глобални конфигурации, базни templates/static, root рути и seed механизам (иницијално полнење на база).
- **accounts** – регистрација/најава/одјава и custom User модел со поле `role`.
- **restaurants** – ресторани, менија/продукти, категории, работно време и достапност.
- **orders** – кошничка, нарачки, пресметка на вкупна цена, статуси и tracking тек.
- **payments** – изолиран payment flow: Stripe интеграција и симулирани плаќања.

Оваа поделба овозможува полесно одржување, тестирање и проширување на системот, бидејќи секој домен е изолиран и јасно дефиниран.

---

## Автентикација, авторизација и улоги (RBAC)

Системот користи **RBAC (role-based access control)** со следните улоги и дозволи:

| Role     | Клучни дозволи |
|----------|----------------|
| Customer | Преглед/пребарување, кошничка, checkout, плаќање, My Orders, Track Order |
| Owner    | CRUD за сопствени ресторани/мени (само свои ресурси) |
| Courier  | Accept нарачки, Start delivery, Mark delivered, историја на достави |
| Admin    | Административен пристап (апликациски admin слој + Django Admin за superuser) |

**Правила:**
- Секој новорегистриран корисник добива улога `customer`.
- Корисник не може самостојно да ја промени улогата.
- Промена на улога е дозволена исклучиво за администратор.

---

## Кориснички текови (User flows)

### Customer (краен корисник)
1. **Browse:** преглед и пребарување на ресторани/мени (server-side + client-side search).
2. **Select:** избор на ресторан и додавање продукти во **Cart** (се прикажуваат само достапни продукти).
3. **Checkout:** потврда на нарачка и пресметка на вкупна цена.
4. **Pay:** Stripe (test mode) или симулирано плаќање.
5. **Track:** **My Orders → Track Order** (преглед на статуси и tracking demo).

### Courier (доставувач)
1. **Pickup queue:** “Available Orders for Pickup” (статус `Confirmed`) → **Accept**.
2. **Active delivery:** “My Active Deliveries” (статуси `Accepted` / `Picked_up`) → **Start delivery** → **Mark delivered**.
3. **History:** “My Delivered Orders” (статус `Delivered`) како историја.

### Owner (сопственик)
- Управување со **сопствени** ресторани и менија (CRUD) преку owner интерфејс.  
- Пристапот е ограничен исклучиво на ресурси што му припаѓаат на сопственикот.

### Admin (администратор)
- Пристап до административни функционалности преку **custom admin слој**.
- Целосна контрола врз корисници/улоги, ресторани/продукти, нарачки/статуси и плаќања.
- (Опционално) Дополнителна администрација преку **Django Admin Panel** (само за superuser).

---

## Тек на нарачка и статуси

Нарачката поминува низ следниве состојби:

| Status      | Опис |
|-------------|------|
| **Placed**     | Нарачка креирана по checkout |
| **Confirmed**  | Потврдена нарачка (успешно платена и/или прифатена за подготовка) |
| **Accepted**   | Преземена од courier (доделен курир) |
| **Picked_up**  | Курирот ја подигнал нарачката и е „на пат“ |
| **Delivered**  | Доставена (финална состојба) |
| **Canceled**   | Откажана (опционално) |

**Клучни правила за видливост:**
- Courier ги гледа нарачките во dashboard **дури по** `Confirmed`.
- Track Order мапата се прикажува само во релевантни фази (види следната секција).

---

## Мапа и симулација на достава (Live tracking demo)

Track Order страницата вклучува демо симулација (не реален GPS tracking).

### Кога се прикажува мапата
- Ако нарачката **нема доделен courier** → **не** се прикажува мапа (само прогрес/статуси).
- Ако статусот е `Accepted`, `Picked_up` или `Delivered` → се прикажува Leaflet мапа со:
  - локација на ресторан,
  - локација на customer,
  - позиција на courier (демо маркер).

### Анимација (само за `Picked_up`)
- Анимацијата се активира **само** кога статусот е `Picked_up`.
- Се користи `requestAnimationFrame` за мазно движење.
- Траење: **30 секунди** (ease-in-out).
- Позицијата се пресметува со линеарна интерполација (lerp) од ресторан → customer.

### Автоматско означување `Delivered`
По истек на 30 секунди, frontend праќа AJAX POST кон:
- ` /orders/track/<order_id>/mark-delivered/ `

Endpoint-от:
- проверува дали статусот е `picked_up`,
- го менува во `delivered`,
- враќа JSON одговор, по што страницата се рефрешира.

### Ограничувања (демо)
- Нема реален GPS.
- Геокодирањето е симулирано (dummy coordinates).
- Траењето е фиксни **30 секунди**, независно од растојание.

---

## Плаќање: Stripe (test mode) и симулирано плаќање

Платежниот процес е изолиран во модулот **payments**.

- Секој обид за плаќање се евидентира преку `Payment` поврзан со нарачка (износ, валута, статус, PaymentIntent id).
- При checkout:
  - ако Stripe е конфигуриран → се креира **PaymentIntent (test mode)** и се користи **Stripe Elements** на frontend,
  - ако Stripe не е достапен → се користи симулирано плаќање (success/fail) преку посебни endpoint-и.

**Stripe тест картички:** https://docs.stripe.com/testing

---

## Податоци: Scraping и Seed механизам

Апликацијата не зависи од надворешни API сервиси за иницијални податоци:
- податоците за ресторани и менија се scrape-ани од Korpa,
- структурирани во Python,
- внесени во база преку Django seed механизам (`seed_data.py` или management command).

Ова обезбедува реалистична демо база и повторливо поставување на проектот.

---

## Администрација и управување

Администрацијата е поделена во две целини:

1) **Custom Admin Dashboard**  
   Достапен само за `admin`, со server-side проверка на улога.

2) **Django Admin Panel**  
   Достапен само за **superuser** и овозможува целосна контрола врз:
   - корисници и улоги,
   - ресторани и продукти,
   - нарачки и статуси,
   - плаќања и состојби.

---

## Локално стартување (Development)

> Чекорите подолу се стандардни за Django development. Прилагоди ги според вашата проектна конфигурација (requirements/seed команда).

### 1) (Опционално) Virtual environment
```bash
python -m venv .venv
# Windows:
.venv\Scripts\activate
# macOS/Linux:
source .venv/bin/activate
```

### 2) Зависности (ако имате requirements.txt)
```bash
pip install -r requirements.txt
```

### 3) Миграции
```bash
python manage.py migrate
```

### 4) (Опционално) Seed податоци
> Доколку проектот има активиран seed механизам (на пр. `seed_data.py` или management command), изврши го според инструкциите во проектот.

### 5) Стартувај сервер
```bash
python manage.py runserver
```

### 6) (Опционално) Креирај superuser за Django Admin
```bash
python manage.py createsuperuser
```

---

## Тест корисници

| Role     | Username | Password |
|----------|----------|----------|
| Customer | customer | customer |
| Owner    | owner    | owner    |
| Courier  | courier  | courier  |
| Admin    | admin    | admin    |

---

## Автори

- Ана Андовска (221126)  
- Мила Јованоска (221034)
